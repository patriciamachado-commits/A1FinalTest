<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A1 Final Test - PS1</title>
    <style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#1565C0;min-height:100vh;padding:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.container{max-width:800px;margin:0 auto}
.header{background:#fff;border-radius:20px;padding:30px;margin-bottom:20px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.2)}
.header h1{color:#1565C0;font-size:1.5em;margin-bottom:10px}
.header p{color:#666}
.badge{background:#ef4444;color:#fff;padding:4px 12px;border-radius:20px;font-size:.8em}
.level-badge{background:#1565C0;color:#fff;padding:6px 16px;border-radius:20px;font-size:.9em;display:inline-block;margin-bottom:15px}
.card{background:#fff;border-radius:16px;padding:25px;margin-bottom:20px}
.card h2{color:#1565C0;margin-bottom:15px}
label{font-weight:600;color:#333;display:block;margin-bottom:8px}
input[type="text"],select,textarea{width:100%;padding:14px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;margin-bottom:15px;font-family:inherit}
input:focus,select:focus,textarea:focus{outline:none;border-color:#1565C0}
textarea{min-height:120px;resize:vertical}
.btn{background:#1565C0;color:#fff;border:none;padding:14px 32px;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;width:100%;margin-top:10px}
.btn:hover{background:#0D47A1}
.btn-orange{background:#F5A623}
.btn-green{background:#22c55e}
.section{display:none}
.section.active{display:block}
.question{background:#f8f9fa;border-radius:12px;padding:20px;margin:15px 0}
.question-num{background:#1565C0;color:#fff;width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-weight:700;margin-right:10px;font-size:13px;flex-shrink:0}
.question h4{margin-bottom:15px;color:#333;display:flex;align-items:flex-start;line-height:1.5}
.question h4 span{flex:1}
.option{padding:12px 15px;border:2px solid #e0e0e0;border-radius:10px;cursor:pointer;margin-bottom:8px;display:flex;align-items:center;gap:12px}
.option:hover{border-color:#1565C0;background:#e3f2fd}
.option.selected{border-color:#1565C0;background:#bbdefb}
.option.correct{border-color:#22c55e;background:#f0fdf4}
.option.incorrect{border-color:#ef4444;background:#fef2f2}
.circle{width:24px;height:24px;border:2px solid #ccc;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:12px;color:#666}
.option.selected .circle{border-color:#1565C0;background:#1565C0;color:#fff}
.option.correct .circle{background:#22c55e;border-color:#22c55e;color:#fff}
.option.incorrect .circle{background:#ef4444;border-color:#ef4444;color:#fff}
.progress{height:10px;background:#e0e0e0;border-radius:5px;margin-bottom:15px}
.progress-bar{height:100%;background:linear-gradient(90deg,#1565C0,#42A5F5);border-radius:5px;transition:width .3s}
.progress-text{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px;color:#666}
.score-card{background:linear-gradient(135deg,#1565C0,#1E88E5);border-radius:20px;padding:35px;color:#fff;text-align:center}
.score-big{font-size:4em;font-weight:700}
.result-box{background:rgba(255,255,255,.15);border-radius:12px;padding:20px;margin-top:20px}
.links-section{background:#fff;border-radius:16px;padding:25px;margin-top:20px}
.links-section h3{color:#1565C0;margin-bottom:20px;text-align:center}
.link-btn{display:block;padding:18px 20px;border-radius:12px;margin-bottom:15px;text-decoration:none;font-weight:600;text-align:center}
.link-btn.survey{background:#9c27b0;color:#fff}
.link-btn.premium{background:#22c55e;color:#fff}
.link-btn.waitlist{background:#F5A623;color:#fff}
.applied-msg{background:#e3f2fd;border:2px solid #1565C0;border-radius:12px;padding:15px;color:#1565C0;font-weight:600;text-align:center;margin-top:15px}
.timer{background:#fff3cd;border:2px solid #ffc107;border-radius:12px;padding:15px;text-align:center;margin-bottom:20px}
.timer-text{font-size:1.8em;font-weight:700;color:#856404}
.timer.warning{background:#ffebee;border-color:#ef5350}
.timer.warning .timer-text{color:#c62828}
.instructions{background:#e3f2fd;border-left:4px solid #1565C0;padding:15px 20px;border-radius:0 12px 12px 0;margin-bottom:20px}
.not-submitted{background:#ffebee;border:2px solid #ef5350;border-radius:12px;padding:20px;text-align:center}
.not-submitted h3{color:#c62828;margin-bottom:10px}
.not-submitted p{color:#333}
.submitted-success{background:#e8f5e9;border:2px solid #66bb6a;border-radius:12px;padding:20px;text-align:center;display:none}
.submitted-success h3{color:#2e7d32}
.writing-prompt{background:#fff3cd;border:1px solid #ffc107;border-radius:12px;padding:20px;margin-bottom:20px}
.writing-prompt h4{color:#856404;margin-bottom:10px}
.word-count{text-align:right;color:#888;font-size:14px;margin-top:5px}
/* Anti-cheat warning */
.tab-warning{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column;color:#fff;text-align:center;padding:20px}
.tab-warning.show{display:flex}
.tab-warning h2{color:#ef4444;font-size:2em;margin-bottom:20px}
.tab-warning p{font-size:1.2em;margin-bottom:30px;max-width:500px}
.tab-warning .btn{width:auto;padding:15px 40px}
.warning-count{background:#ef4444;color:#fff;padding:8px 15px;border-radius:8px;font-size:14px;display:inline-block;margin-left:10px}
.integrity-notice{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:10px 15px;margin-bottom:15px;font-size:14px;color:#856404}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="level-badge">CEFR Level A1 - Beginner</div>
        <h1>üìù PS1 Final Test <span class="badge">30 Questions</span></h1>
        <p>Practical Skills 1 - Term 1/2026</p>
    </div>

    <div class="section active" id="start">
        <div class="card">
            <h2>Welcome to Your Final Test!</h2>
            <div class="instructions">
                <p><strong>üìã Instructions:</strong></p>
                <ul style="padding-left:20px">
                    <li>30 multiple-choice questions</li>
                    <li>30 minutes to complete</li>
                    <li>Writing section at the end</li>
                    <li>Stay in Zoom after finishing</li>
                </ul>
            </div>
            <div class="integrity-notice">
                ‚ö†Ô∏è <strong>Academic Integrity:</strong> This test monitors for tab switching. Please stay on this page until you finish. Leaving the test tab will be recorded and reported to your teacher.
            </div>
            
            <label>Your Full Name (This will be on your CERTIFICATE)</label>
            <input type="text" id="studentName" placeholder="Enter your full name...">
            
            <label>Your Class</label>
            <select id="studentClass">
                <option value="">Select your class...</option>
                <option value="3071-MW-11AM">3071 - Mon/Wed 11:00 AM (Eunice)</option>
                <option value="3081-TTH-11AM">3081 - Tue/Thu 11:00 AM (Eunice)</option>
            </select>
            
            <button class="btn" onclick="startTest()">Start Test ‚Üí</button>
        </div>
    </div>

    <div class="section" id="test">
        <div class="card">
            <div class="timer" id="timerBox">
                <div>‚è±Ô∏è Time Remaining <span class="warning-count" id="warningBadge" style="display:none">‚ö†Ô∏è Tab switches: <span id="warningNum">0</span></span></div>
                <div class="timer-text" id="timer">30:00</div>
            </div>
            <div class="progress-text"><span>Progress</span><span id="answeredCount">0/30 answered</span></div>
            <div class="progress"><div class="progress-bar" id="progressBar" style="width:0%"></div></div>
            <div id="questionsContainer"></div>
            <button class="btn btn-orange" onclick="submitTest()" style="margin-top:25px">Submit Test & Continue to Writing ‚úì</button>
        </div>
    </div>

    <div class="section" id="writing">
        <div class="card">
            <h2>‚úçÔ∏è Writing Section</h2>
            <div class="writing-prompt">
                <h4>üìù Write about yourself (6-8 sentences):</h4>
                <ul style="padding-left:20px">
                    <li>What is your name?</li>
                    <li>Where are you from?</li>
                    <li>Where do you live now?</li>
                    <li>What do you do (job/study)?</li>
                    <li>What do you like to do?</li>
                </ul>
            </div>
            <textarea id="writingAnswer" placeholder="My name is... I am from... I live in... I work/study..."></textarea>
            <div class="word-count">Words: <span id="wordCount">0</span></div>
            <button class="btn btn-green" onclick="submitWriting()" style="margin-top:20px">Submit & See Results ‚Üí</button>
        </div>
    </div>

    <div class="section" id="results">
        <div class="score-card">
            <p style="opacity:.8">üéâ Test Complete!</p>
            <div class="score-big" id="finalScore">0/30</div>
            <div id="percentage" style="font-size:1.2em;margin-top:10px">0%</div>
            <p id="studentDisplay" style="margin-top:15px"></p>
            <div class="result-box"><h3>üìä Your Result</h3><p id="resultMessage"></p></div>
        </div>
        
        <div class="card" style="margin-top:20px">
            <div class="not-submitted" id="notSubmittedWarning"><h3>‚ö†Ô∏è NOT YET SUBMITTED</h3><p>Click the button below to submit your results to your teacher</p></div>
            <div class="submitted-success" id="submittedSuccess"><h3>‚úÖ Submitted!</h3></div>
            <button class="btn btn-orange" id="submitBtn" onclick="submitToTeacher()" style="margin-top:15px;font-size:18px;padding:18px">üì§ Submit to Teacher</button>
        </div>

        <div class="links-section">
            <h3>üìã What's Next?</h3>
            <a href="https://f4m0tbsjd6f.typeform.com/to/niGGm7g7" target="_blank" class="link-btn survey">üìä Take Our Survey</a>
            <a href="https://sqaeducation.org/upgrade-to-premium/" target="_blank" class="link-btn premium">‚≠ê Upgrade to Premium</a>
            <a href="https://sqaeducation.org/login/" target="_blank" class="link-btn waitlist">‚è≥ Current Student Waitlist</a>
            <div class="applied-msg">‚úÖ Already applied? See you next term! üéì</div>
        </div>
    </div>
</div>

<!-- Tab Warning Overlay -->
<div class="tab-warning" id="tabWarning">
    <h2>‚ö†Ô∏è Warning: You Left the Test!</h2>
    <p>Leaving the test tab has been recorded. Your teacher will see this in your results. Please stay on this page to complete your test.</p>
    <button class="btn" onclick="dismissWarning()">Return to Test</button>
</div>

<script>
const SESSION = 'A1 Final Test (PS1)';
let studentName='',studentClass='',score=0,writingText='',timerInterval,timeLeft=30*60;
let tabSwitchCount=0,testStarted=false,testSubmitted=false;

// Original questions from Testmoz
const originalQuestions = [
    {q:"What is the correct way to greet someone in the morning?", opts:["Good night.","Good morning.","Good evening.","Goodbye."], correct:1},
    {q:"How do you say your name? 'My _____ is John.'", opts:["name","named","names","naming"], correct:0},
    {q:"What is the correct response to 'How are you?'", opts:["I am fine, thank you.","I have fine.","I be fine.","I do fine."], correct:0},
    {q:"Choose the correct sentence:", opts:["She am a teacher.","She is a teacher.","She are a teacher.","She be a teacher."], correct:1},
    {q:"What is the plural of 'book'?", opts:["bookes","bookies","books","booken"], correct:2},
    {q:"There is ___ apple on the table.", opts:["a","an","the","no article"], correct:1},
    {q:"What is the opposite of 'big'?", opts:["tall","small","long","wide"], correct:1},
    {q:"Complete: 'I ___ from Brazil.'", opts:["is","are","am","be"], correct:2},
    {q:"Which is a color?", opts:["table","blue","happy","run"], correct:1},
    {q:"How do you say '10' in English?", opts:["tem","ten","tan","tin"], correct:1},
    {q:"Complete: 'They ___ students.'", opts:["is","am","are","be"], correct:2},
    {q:"What day comes after Monday?", opts:["Wednesday","Sunday","Tuesday","Thursday"], correct:2},
    {q:"Choose the correct sentence:", opts:["He have a car.","He has a car.","He having a car.","He haves a car."], correct:1},
    {q:"What is this? üçé", opts:["orange","banana","apple","grape"], correct:2},
    {q:"Complete: 'She ___ a doctor.'", opts:["am","is","are","be"], correct:1},
    {q:"How do you ask about someone's job?", opts:["What you do?","What do you do?","What does you do?","You do what?"], correct:1},
    {q:"Which word is a number?", opts:["red","three","big","fast"], correct:1},
    {q:"Complete: 'We ___ happy.'", opts:["is","am","are","be"], correct:2},
    {q:"What is the opposite of 'hot'?", opts:["warm","cold","cool","nice"], correct:1},
    {q:"Choose the correct possessive: '___ book' (belonging to him)", opts:["He","Him","His","He's"], correct:2},
    {q:"Which sentence is correct?", opts:["I no like coffee.","I don't like coffee.","I not like coffee.","I doesn't like coffee."], correct:1},
    {q:"What time is it? üïê (1:00)", opts:["It's one clock.","It's one o'clock.","It's hour one.","It's time one."], correct:1},
    {q:"Complete: 'There ___ a book on the table.'", opts:["am","are","is","be"], correct:2},
    {q:"Which is NOT a family member?", opts:["mother","brother","teacher","sister"], correct:2},
    {q:"How do you say goodbye?", opts:["See you later.","Good morning.","Hello.","How are you?"], correct:0},
    {q:"Complete: 'I ___ English every day.'", opts:["study","studies","studying","studys"], correct:0},
    {q:"What color is the sky?", opts:["green","blue","red","yellow"], correct:1},
    {q:"Choose the correct preposition: 'The cat is ___ the table.'", opts:["in","on","at","to"], correct:1},
    {q:"Complete: 'My mother ___ a nurse.'", opts:["am","are","is","be"], correct:2}
];

// Shuffle function
function shuffle(array){
    const arr=[...array];
    for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}

// Prepare randomized questions
let questions=[];
let questionMap=[];

function prepareQuestions(){
    // Shuffle question order
    const shuffledIndices=shuffle([...Array(originalQuestions.length).keys()]);
    questions=[];
    questionMap=[];
    
    shuffledIndices.forEach((origIndex,newIndex)=>{
        const orig=originalQuestions[origIndex];
        // Shuffle options
        const optionsWithIndex=orig.opts.map((opt,i)=>({text:opt,wasCorrect:i===orig.correct}));
        const shuffledOpts=shuffle(optionsWithIndex);
        const newCorrect=shuffledOpts.findIndex(o=>o.wasCorrect);
        
        questions.push({
            q:orig.q,
            opts:shuffledOpts.map(o=>o.text),
            correct:newCorrect,
            origIndex:origIndex
        });
        questionMap.push({origIndex,newIndex});
    });
}

function startTest(){
    studentName=document.getElementById('studentName').value.trim();
    studentClass=document.getElementById('studentClass').value;
    if(!studentName){alert('Please enter your full name');return;}
    if(!studentClass){alert('Please select your class');return;}
    
    prepareQuestions();
    renderQuestions();
    document.getElementById('start').classList.remove('active');
    document.getElementById('test').classList.add('active');
    testStarted=true;
    startTimer();
    startAntiCheat();
    window.scrollTo(0,0);
}

function renderQuestions(){
    let html='';
    questions.forEach((q,i)=>{
        html+=`<div class="question"><h4><span class="question-num">${i+1}</span><span>${q.q}</span></h4><div class="options">`;
        q.opts.forEach((opt,j)=>{
            html+=`<div class="option" data-q="${i}" data-v="${j}" onclick="selectAnswer(this)"><div class="circle">${String.fromCharCode(65+j)}</div><span>${opt}</span></div>`;
        });
        html+=`</div></div>`;
    });
    document.getElementById('questionsContainer').innerHTML=html;
}

function selectAnswer(el){
    const qNum=el.dataset.q;
    document.querySelectorAll(`.option[data-q="${qNum}"]`).forEach(o=>o.classList.remove('selected'));
    el.classList.add('selected');
    updateProgress();
}

function updateProgress(){
    const answered=document.querySelectorAll('.option.selected').length;
    document.getElementById('answeredCount').textContent=`${answered}/30 answered`;
    document.getElementById('progressBar').style.width=`${(answered/30)*100}%`;
}

function startTimer(){
    timerInterval=setInterval(()=>{
        timeLeft--;
        const mins=Math.floor(timeLeft/60),secs=timeLeft%60;
        document.getElementById('timer').textContent=`${mins}:${secs.toString().padStart(2,'0')}`;
        if(timeLeft<=300)document.getElementById('timerBox').classList.add('warning');
        if(timeLeft<=0){clearInterval(timerInterval);alert('‚è∞ Time is up!');submitTest();}
    },1000);
}

// Anti-cheat functions
function startAntiCheat(){
    // Disable right-click
    document.addEventListener('contextmenu',e=>e.preventDefault());
    
    // Disable copy/cut/paste
    document.addEventListener('copy',e=>e.preventDefault());
    document.addEventListener('cut',e=>e.preventDefault());
    document.addEventListener('paste',e=>e.preventDefault());
    
    // Disable keyboard shortcuts
    document.addEventListener('keydown',e=>{
        if(e.ctrlKey&&(e.key==='c'||e.key==='v'||e.key==='x'||e.key==='a'||e.key==='p')){
            e.preventDefault();
        }
        if(e.key==='F12'||e.key==='PrintScreen'){
            e.preventDefault();
        }
    });
    
    // Tab visibility detection
    document.addEventListener('visibilitychange',()=>{
        if(document.hidden&&testStarted&&!testSubmitted){
            tabSwitchCount++;
            updateWarningBadge();
            document.getElementById('tabWarning').classList.add('show');
        }
    });
    
    // Window blur detection
    window.addEventListener('blur',()=>{
        if(testStarted&&!testSubmitted){
            tabSwitchCount++;
            updateWarningBadge();
            document.getElementById('tabWarning').classList.add('show');
        }
    });
}

function updateWarningBadge(){
    const badge=document.getElementById('warningBadge');
    const num=document.getElementById('warningNum');
    badge.style.display='inline';
    num.textContent=tabSwitchCount;
}

function dismissWarning(){
    document.getElementById('tabWarning').classList.remove('show');
}

function submitTest(){
    clearInterval(timerInterval);
    testSubmitted=true;
    score=0;
    questions.forEach((q,i)=>{
        const sel=document.querySelector(`.option[data-q="${i}"].selected`);
        if(sel){
            if(parseInt(sel.dataset.v)===q.correct){score++;sel.classList.add('correct');}
            else{sel.classList.add('incorrect');document.querySelector(`.option[data-q="${i}"][data-v="${q.correct}"]`).classList.add('correct');}
        }else{document.querySelector(`.option[data-q="${i}"][data-v="${q.correct}"]`).classList.add('correct');}
    });
    document.getElementById('test').classList.remove('active');
    document.getElementById('writing').classList.add('active');
    window.scrollTo(0,0);
}

document.addEventListener('DOMContentLoaded',()=>{
    const w=document.getElementById('writingAnswer');
    if(w)w.addEventListener('input',function(){document.getElementById('wordCount').textContent=this.value.trim().split(/\s+/).filter(x=>x).length;});
});

function submitWriting(){
    writingText=document.getElementById('writingAnswer').value.trim();
    if(writingText.length<20&&!confirm('Writing is short. Continue?'))return;
    const pct=Math.round(score/30*100);
    document.getElementById('finalScore').textContent=score+'/30';
    document.getElementById('percentage').textContent=pct+'%';
    document.getElementById('studentDisplay').textContent=studentName+' ‚Ä¢ '+studentClass;
    document.getElementById('resultMessage').textContent=pct>=85?'üåü Excellent! Ready for A2!':pct>=70?'üëç Good job! Solid A1.':pct>=50?'üìö Keep practicing.':'üí™ More practice needed.';
    document.getElementById('writing').classList.remove('active');
    document.getElementById('results').classList.add('active');
    window.scrollTo(0,0);
}

function submitToTeacher(){
    const pct=Math.round(score/30*100);
    const level=pct>=85?'A1+ Ready for A2':pct>=70?'A1':pct>=50?'A1-':'Pre-A1';
    const integrityNote=tabSwitchCount>0?` [‚ö†Ô∏è Tab switches: ${tabSwitchCount}]`:'';
    const formData=new FormData();
    formData.append('entry.1448652901',studentName+' ['+studentClass+']'+integrityNote);
    formData.append('entry.1074820059',SESSION);
    formData.append('entry.948848038',score+'/30');
    formData.append('entry.55871862',pct+'%');
    formData.append('entry.386745226',writingText+(tabSwitchCount>0?`\n\n[INTEGRITY NOTE: Student left test tab ${tabSwitchCount} time(s)]`:''));
    formData.append('entry.1166198123',level);
    fetch('https://docs.google.com/forms/d/e/1FAIpQLSdbBVpC7yn8QYq2cLwYP-O-XMITpJd6aX99S_8Mca3O-rUurQ/formResponse',{method:'POST',mode:'no-cors',body:formData}).then(()=>{
        document.getElementById('notSubmittedWarning').style.display='none';
        document.getElementById('submittedSuccess').style.display='block';
        document.getElementById('submitBtn').style.display='none';
    });
}
</script>
</body>
</html>
